<template>
    <lightning-card title={cardTitle} icon-name={cardIconName}>

        <!-- WHILE DATA IS LOADED -->
        <template if:false={isLoading}>

            <!-- TIER ONE -->
            <div class="slds-var-p-left_x-small slds-var-p-top_large">
                Ticket Number: {ultimateParentTicket.Name}&nbsp;
                <span if:true={ultimateParentTicket.isCurrentRecord} class="slds-text-heading_large slds-text-color_destructive">
                    &rArr;You are here.&lArr;
                </span>
                <lightning-button-icon 
                    if:false={ultimateParentTicket.isCurrentRecord} 
                    icon-name="utility:setup_assistant_guide" 
                    variant="brand" 
                    alternative-text="View Record" 
                    class="slds-m-left_small" 
                    data-id={ultimateParentTicket.Id} 
                    data-subject={ultimateParentTicket.Subject__c} 
                    title="View Record" 
                    onclick={goToRecordPage}
                ></lightning-button-icon><br />
                {ultimateParentTicket.Subject__c}
                <hr />
            </div>

            <!-- TIERS TWO AND THREE -->
            <template for:each={mapTierThreeTickets} for:item="tierThreeRow">
                <div key={tierThreeRow.parentTicket} class="slds-var-p-left_x-large slds-var-p-top_large">
                    Ticket Number: {tierThreeRow.parentTicket.Name}&nbsp;
                    <span if:true={tierThreeRow.parentTicket.isCurrentRecord} class="slds-text-heading_large slds-text-color_destructive">
                        &rArr;You are here.&lArr;
                    </span>
                    <lightning-button-icon 
                        if:false={tierThreeRow.parentTicket.isCurrentRecord}
                        icon-name="utility:setup_assistant_guide" 
                        variant="brand" 
                        alternative-text="View Record" 
                        class="slds-m-left_small" 
                        data-id={tierThreeRow.parentTicket.Id} 
                        data-subject={tierThreeRow.parentTicket.Subject__c} 
                        title="View Record" 
                        onclick={goToRecordPage}
                    ></lightning-button-icon><br />
                    Subject: {tierThreeRow.parentTicket.Subject__c}<br />
                    Description: {tierThreeRow.parentTicket.Description__c}
                    <hr />
                    <template for:each={tierThreeRow.childTickets} for:item="childTicket">
                        <div class="slds-var-p-left_xx-large slds-var-p-top_large" key={childTicket.Id}>
                            Ticket Number: {childTicket.Name}&nbsp;
                            <span if:true={childTicket.isCurrentRecord} class="slds-text-heading_large slds-text-color_destructive">
                                &rArr;You are here.&lArr;
                            </span>
                            <lightning-button-icon 
                                if:false={childTicket.isCurrentRecord}
                                icon-name="utility:setup_assistant_guide" 
                                variant="brand" 
                                alternative-text="View Record" 
                                class="slds-m-left_small" 
                                data-id={childTicket.Id} 
                                data-subject={childTicket.Subject__c} 
                                title="View Record" 
                                onclick={goToRecordPage}
                            ></lightning-button-icon><br />
                            Subject: {childTicket.Subject__c}<br />
                            Description: {childTicket.Description__c}
                            <hr />
                        </div>
                    </template>
                </div>
            </template>

        </template>

        <!-- SPINNER ON LOAD -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="...loading"></lightning-spinner>
        </template>

    </lightning-card>
</template>